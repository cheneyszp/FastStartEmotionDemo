# Azure Quick Start 1# Epcisode: Know-You
Cognitive Service Face API+ Emotion API and Azure SQL Database and PowerBI 

## ç¯å¢ƒå‡†å¤‡
- æ³¨å†ŒAzureè´¦å·ï¼ˆ[1å…ƒè¯•ç”¨è´¦å·ç”³è¯·](https://www.azure.cn/pricing/1rmb-trial-full/)ï¼‰
- å®‰è£…Visual Studio Codeï¼ˆ[ä¸‹è½½](https://code.visualstudio.com/Download)ï¼‰ï¼ˆç”¨äºè°ƒè¯•ä»£ç ï¼‰
- å®‰è£…Gitï¼ˆ[ä¸‹è½½](https://git-scm.com/downloads)ï¼‰ ï¼ˆç”¨äºéƒ¨ç½²åº”ç”¨ï¼‰

## åˆ›å»ºè®¤çŸ¥æœåŠ¡API

æœ¬ä¾‹ä½¿ç”¨Azureè®¤çŸ¥æœåŠ¡ä¸­çš„äººè„¸è¯†åˆ«APIä»¥åŠæƒ…ç»ªè¯†åˆ«çš„APIã€‚éœ€è¦åˆ›å»ºä¸¤ä¸ªè®¤çŸ¥æœåŠ¡ï¼Œè·å¾—è¿™ä¸¤ä¸ªæœåŠ¡çš„keyã€‚

1. ä½¿ç”¨Azureè´¦å·ç™»é™†[Azureé—¨æˆ·](http://portal.azure.cn)
2. ç™»é™†åï¼Œ é€‰æ‹©æ–°å»º->Data+Analytics-> è®¤çŸ¥æœåŠ¡APIs

![åˆ›å»ºè®¤çŸ¥æœåŠ¡-1](/images/cog1.jpg)

3. è®¾ç½®è´¦æˆ·åç§°ï¼ŒAPIç±»å‹ï¼ˆäººè„¸APIï¼‰ä»¥åŠå®šä»·å±‚ï¼Œç‚¹å‡»åˆ›å»ºå³å¯ã€‚
4. åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥åœ¨æ‰€æœ‰èµ„æºåˆ—è¡¨ä¸­çœ‹åˆ°åˆšåˆšåˆ›å»ºçš„faceapi,ç‚¹å‡»è¿›å…¥åˆ°æ¦‚è¿°ç•Œé¢ã€‚

![åˆ›å»ºè®¤çŸ¥æœåŠ¡-2](/images/cog2.jpg)

5. ç‚¹å‡»â€œå¯†é’¥â€ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªå¯†é’¥ï¼Œè®°ä¸‹å…¶ä¸­ä¸€ä¸ªã€‚

![åˆ›å»ºè®¤çŸ¥æœåŠ¡-3](/images/cog3.jpg)

6. å›åˆ°Azure Portalçš„é¦–é¡µï¼Œ é€‰æ‹©æ–°å»º->Data+Analytics-> è®¤çŸ¥æœåŠ¡APIs

![åˆ›å»ºè®¤çŸ¥æœåŠ¡-4](/images/cog4.jpg)

7. è®¾ç½®è´¦æˆ·åç§°ï¼ŒAPIç±»å‹ï¼ˆæƒ…ç»ªAPIï¼‰ä»¥åŠå®šä»·å±‚ï¼Œç‚¹å‡»åˆ›å»ºå³å¯ã€‚
8. åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥åœ¨æ‰€æœ‰èµ„æºåˆ—è¡¨ä¸­çœ‹åˆ°åˆšåˆšåˆ›å»ºçš„emotionapi,ç‚¹å‡»è¿›å…¥åˆ°æ¦‚è¿°ç•Œé¢ã€‚

![åˆ›å»ºè®¤çŸ¥æœåŠ¡-5](/images/cog5.jpg)

9. ç‚¹å‡»â€œå¯†é’¥â€ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªå¯†é’¥ï¼Œè®°ä¸‹å…¶ä¸­ä¸€ä¸ªã€‚


![åˆ›å»ºè®¤çŸ¥æœåŠ¡-6](/images/cog6.jpg)

## åˆ›å»ºWebåº”ç”¨

æœ¬ä¾‹ä½¿ç”¨Azure Web Appæ¥æ‰¿è½½ç½‘ç«™å†…å®¹ï¼Œç½‘ç«™å†…å®¹ä½¿ç”¨Node.jsæ¥ç¼–å†™ã€‚
1. ä½¿ç”¨Azureè´¦å·ç™»é™†[Azureé—¨æˆ·](http://portal.azure.cn)
2. ç™»é™†åï¼Œ é€‰æ‹©æ–°å»º->Web+Mobile-> Webåº”ç”¨

![åˆ›å»ºWebåº”ç”¨-1](/images/webapp1.jpg)

3. è®¾ç½®ç›¸åº”çš„åº”ç”¨åç§°ã€èµ„æºç»„ä»¥åŠåº”ç”¨è®¡åˆ’ï¼Œç‚¹å‡»åˆ›å»ºã€‚
4. Webåº”ç”¨åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥åœ¨èµ„æºåˆ—è¡¨ä¸­çœ‹åˆ°åˆšåˆšåˆ›å»ºçš„"ocpemtion"ï¼Œç‚¹å‡»è¿›å…¥Web Appæ¦‚è¿°é¡µï¼Œå…¶ä¸­URLä¸ºä½ çš„Webåº”ç”¨çš„åœ°å€ã€‚

![åˆ›å»ºWebåº”ç”¨-2](/images/webapp2.jpg)

5. ç‚¹å‡»éƒ¨ç½²å‡­æ®ï¼Œè®¾ç½®ç”¨æˆ·åå’Œå¯†ç ã€‚è¿™ä¸ªä½œä¸ºFTPæˆ–è€…GITçš„éƒ¨ç½²å‡­æ®ï¼Œè¯·ç‰¢è®°ç”¨æˆ·åå¯†ç  ğŸ˜Š


![åˆ›å»ºWebåº”ç”¨-3](/images/webapp3.jpg)

6. ç‚¹å‡»éƒ¨ç½²é€‰é¡¹ï¼Œé€‰æ‹©éƒ¨ç½²æºã€‚Webåº”ç”¨å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼éƒ¨ç½²ï¼Œæ¯”è¾ƒæµè¡Œçš„åšæ³•æ˜¯é€šè¿‡Gitæ¥éƒ¨ç½²ï¼Œæœ¬ç¤ºä¾‹å°†æ¼”ç¤ºé€šè¿‡Gitæ¥éƒ¨ç½²ä½ çš„Node.jsåº”ç”¨ã€‚è®¾ç½®éƒ¨ç½²æºä¸ºâ€œæœ¬åœ°Gitå­˜å‚¨åº“â€ã€‚

![åˆ›å»ºWebåº”ç”¨-4](/images/webapp4.jpg)

7. ç‚¹å‡»ç¡®å®šå³å¯ã€‚

![åˆ›å»ºWebåº”ç”¨-5](/images/webapp5.jpg)


8. å›åˆ°åº”ç”¨æœåŠ¡çš„æ¦‚è¿°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°Gitå…‹éš†url

![åˆ›å»ºWebåº”ç”¨-6](/images/webapp6.jpg)



## åˆ›å»ºæ•°æ®åº“

æœ¬ä¾‹ä¸­ä½¿ç”¨SQL DBä¿å­˜è®¿é—®è¿‡è¯¥ç½‘ç«™çš„ç”¨æˆ·è®°å½•ï¼Œ ä¸»è¦åŒ…æ‹¬ç…§ç‰‡è¯†åˆ«çš„ç»“æœä¿¡æ¯ï¼šæ€§åˆ«ï¼Œå¹´é¾„ï¼Œè¡¨æƒ…ã€‚æœ¬èŠ‚æè¿°å®Œæ•´çš„æ•°æ®åº“éƒ¨ç½²è¿‡ç¨‹ã€‚

æ³¨ï¼šæœ¬ä¾‹ä¸ä¿å­˜ä»»ä½•ç”¨æˆ·ç…§ç‰‡ï¼Œé˜…åå³ç„šã€‚

1. ä½¿ç”¨Azureè´¦å·ç™»é™†[Azureé—¨æˆ·](http://portal.azure.cn)
2. ç™»é™†åï¼Œ é€‰æ‹©æ–°å»º->DataBase->SQLæ•°æ®åº“

![åˆ›å»ºæ•°æ®åº“-1](/images/db1.PNG)

3. è¾“å…¥æ•°æ®åº“é…ç½®ä¿¡æ¯åŒ…æ‹¬ï¼š

    - æ•°æ®åº“åï¼š emotiondb
    - èµ„æºç»„ï¼šé€‰æ‹©åœ¨åˆ›å»ºweb siteæ—¶å·²ç»åˆ›å»ºçš„testèµ„æºç»„
    - æœåŠ¡å™¨åç§°ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ï¼Œè¾“å…¥æœåŠ¡å™¨åç§°emotion
    - æ•°æ®åº“ç®¡ç†å‘˜ï¼šsqldb
    - å¯†ç ï¼šxxxxxxx
    - ç¡®è®¤å¯†ç ï¼šxxxxxxx
    - ä½ç½®ï¼šä¸­å›½åŒ—éƒ¨

è¾“å…¥å®Œæˆåï¼Œé€‰æ‹©ç¡®è®¤ï¼Œåˆ›å»ºã€‚

![åˆ›å»ºæ•°æ®åº“-2](/images/db2.PNG)

4. æ•°æ®åº“å’ŒæœåŠ¡å™¨åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥åœ¨èµ„æºåˆ—è¡¨ä¸­çœ‹åˆ°ï¼Œç‚¹å‡»â€œemotiondbâ€ï¼Œè¿›å…¥æ•°æ®åº“è¯¦æƒ…é¡µï¼š

![åˆ›å»ºæ•°æ®åº“-3](/images/db3.PNG)

5. ç‚¹å‡»æ•°æ®åº“æœåŠ¡å™¨ï¼ˆåœ¨æœåŠ¡å™¨åç§°ä¸‹ï¼‰ï¼Œè®°å½•æ•°æ®åº“æœåŠ¡å™¨åç§°ï¼Œè¿™é‡Œæ˜¯â€œnr8ver0mqe.database.chinacloudapi.cnâ€ï¼Œåé¢åœ¨å»ºç«‹æ•°æ®åº“è¿æ¥æ—¶ä½¿ç”¨ã€‚

![åˆ›å»ºæ•°æ®åº“-4](/images/db4.PNG)

6. é…ç½®æ•°æ®åº“å®¢æˆ·ç«¯è®¿é—®æˆæƒï¼Œè¿›å…¥æ•°æ®æœåŠ¡å™¨è¯¦æƒ…é¡µåï¼Œé€‰æ‹©è®¾ç½®->é˜²ç«å¢™ï¼Œå°†å½“å‰å®¢æˆ·ç«¯ï¼ˆå³å®‰è£…äº†SQL Server Management Studioçš„å®¢æˆ·ç«¯ï¼‰IPåŠ å…¥æˆæƒè®¿é—®åˆ—è¡¨ï¼Œå¹¶ç¡®ä¿å…è®¸è®¿é—®AzureæœåŠ¡é€‰é¡¹æ‰“å¼€ã€‚

![åˆ›å»ºæ•°æ®åº“-5](/images/db5.PNG)

7. æ‰“å¼€æ•°æ®åº“çš„æ¦‚è§ˆé¡µï¼Œç‚¹å‡»â€œå·¥å…·â€

![åˆ›å»ºæ•°æ®åº“-6](/images/db6.jpg)

8. å¯ä»¥ä½¿ç”¨æŸ¥è¯¢ç¼–è¾‘å™¨æ¥åˆ›å»ºæ•°æ®åº“ï¼Œç‚¹å‡»â€œæŸ¥è¯¢ç¼–è¾‘å™¨â€ï¼Œå¹¶ç™»å½•åˆ°æ•°æ®åº“

![åˆ›å»ºæ•°æ®åº“-7](/images/db7.jpg)

9. æˆåŠŸç™»å½•ä¹‹åï¼Œå°†ä»¥ä¸‹ä»£ç ç²˜è´´åˆ°ç¼–è¾‘å™¨ä¸­ï¼Œç‚¹å‡»æ‰§è¡Œï¼Œå®Œæˆemotionlistè¡¨åˆ›å»ºã€‚

```SQL
--Clean the DataBase
IF EXISTS(SELECT * FROM sysobjects WHERE name='emotionlist')
  DROP TABLE emotionlist

--Create Table
--Emotion Access List Table
go
CREATE TABLE emotionlist(
	gender nvarchar(30) Not Null ,
	age varchar(30) Not Null,
	emotion	nvarchar(30) Not Null,
	faceid varchar(100) Not Null,
	time datetime Not Null,
);
CREATE CLUSTERED INDEX EmotionlistIndex ON emotionlist (time ASC); 
go

```

![åˆ›å»ºæ•°æ®åº“-8](/images/db8.jpg)


## é…ç½®Node.jsç¨‹åº

æœ¬ä¾‹ä½¿ç”¨Node.jsä½œä¸ºåç«¯ç¨‹åºï¼Œä½¿ç”¨EJSä½œä¸ºæ¨¡æ¿è¯­è¨€ã€‚

1. è¯·ä»ä»æœ¬ä»“åº“cloneæˆ–è€…ç›´æ¥ä¸‹è½½åˆ°æœ¬åœ°ã€‚

![node.js-1](/images/nodecode1.jpg)


2. ä½¿ç”¨Visual Studio Codeæ‰“å¼€æ–‡ä»¶å¤¹â€œFastStartEmotionDemo-master â€ï¼Œ,ç¼–è¾‘/models/emotiondata.js

```Javascript
// Create connection to database
var config = 
   {
     userName: 'é…ç½®ä¸ºä½ çš„æ•°æ®åº“ç”¨æˆ·å', // update me
     password: 'é…ç½®ä¸ºä½ çš„æ•°æ®åº“ç”¨å¯†ç ', // update me
     server: 'ä½ çš„æ•°æ®åº“æœåŠ¡å™¨.database.chinacloudapi.cn', // update me
     options: 
        {
           database: 'ä½ åˆ›å»ºçš„æ•°æ®åº“åå­—' //update me
           , encrypt: true
        }
   }

```

3. ä½¿ç”¨Visual Studio Codeæ‰“å¼€æ–‡ä»¶å¤¹â€œFastStartEmotionDemo-master â€ï¼Œç¼–è¾‘å…¶ä¸­çš„/public/javascripts/main.jsï¼Œå°†åˆ’çº¿éƒ¨åˆ†å†…å®¹åˆ†åˆ«æ›¿æ¢ä¸ºåˆ›å»ºè®¤çŸ¥APIçš„æ­¥éª¤5å’Œæ­¥éª¤9çš„ä»»æ„ä¸€ä¸ªKeyã€‚

```Javascript
var YOUR_FACE_API_KEY = "é…ç½®ä¸ºä½ åˆ›å»ºçš„è®¤çŸ¥æœåŠ¡äººè„¸è¯†åˆ«APIçš„key";
var YOUR_EMOTION_API_KEY = "é…ç½®ä¸ºä½ åˆ›å»ºçš„è®¤çŸ¥æœåŠ¡æƒ…ç»ªè¯†åˆ«APIçš„key";
```

## éƒ¨ç½²Node.jsç¨‹åº

1. ä¸‹è½½ä¸‹æ¥çš„ä»£ç è§£å‹å‡ºæ¥ã€‚

![Gitä¸Šä¼ éƒ¨ç½²åˆ°Web App-1](/images/git1.jpg)

2.åœ¨è§£å‹å‡ºæ¥çš„æ ¹ç›®å½•ä¸­åˆ›å»ºæœ¬åœ°çš„ä»“åº“ã€‚é¦–å…ˆæ‰“å¼€Windows Powershellæˆ–è€…æ‰“å¼€cmd,ç„¶åcdåˆ°å½“å‰ç›®å½•å³å¯ã€‚

![Gitä¸Šä¼ éƒ¨ç½²åˆ°Web App-2](/images/git2.jpg)

è¾“å…¥åˆ›å»ºæœ¬åœ°ä»“åº“çš„å‘½ä»¤ï¼š

```
git init
```

![Gitä¸Šä¼ éƒ¨ç½²åˆ°Web App-3](/images/git3.jpg)

2. æäº¤å†…å®¹åˆ°æœ¬åœ°ä»“åº“ä¸­

```
git add -A
git commit -m "Initial commit"
```
![Gitä¸Šä¼ éƒ¨ç½²åˆ°Web App-4](/images/git4.jpg)

![Gitä¸Šä¼ éƒ¨ç½²åˆ°Web App-5](/images/git5.jpg)

3. æ·»åŠ Azureçš„è¿œç¨‹Gitä»“åº“åœ°å€

```
git remote add azuregit ä½ çš„è¿œç¨‹ä»“åº“é“¾æ¥åœ°å€ï¼ˆè§åˆ›å»ºWebåº”ç”¨çš„æ­¥éª¤8ï¼‰
```

![Gitä¸Šä¼ éƒ¨ç½²åˆ°Web App-6](/images/git6.jpg)

4. å°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“éƒ¨ç½²

```
 git push azuregit master
```
æ¨é€ä¹‹åï¼Œç¬¬ä¸€æ¬¡éœ€è¦ä½ è¾“å…¥å½“æ—¶åœ¨Azure Web Appé‡Œé¢å¡«å†™çš„éƒ¨ç½²å‡­æ®ã€‚å¦¥å–„ä¿å­˜çš„ç”¨æˆ·åå¯†ç åœ¨è¿™é‡Œç”¨ä¸Šäº†ã€‚
![Gitä¸Šä¼ éƒ¨ç½²åˆ°Web App-7](/images/git7.jpg)

å¡«å†™ä¹‹åå°±å¼€å§‹æ¨é€åˆ°è¿œç«¯éƒ¨ç½²äº†ã€‚

![Gitä¸Šä¼ éƒ¨ç½²åˆ°Web App-8](/images/git8.jpg)

å¤§åŠŸå‘Šæˆï¼

![Gitä¸Šä¼ éƒ¨ç½²åˆ°Web App-9](/images/git9.jpg)

è¿™æ ·ä½ çš„Node.jsç½‘ç«™å·²ç»éƒ¨ç½²å®Œæ¯•ï¼Œæ‚¨å¯ä»¥è®¿é—®æ‚¨åˆ›å»ºçš„Webåº”ç”¨æ¦‚è§ˆé‡Œæ˜¾ç¤ºçš„URLï¼Œå¼€å§‹ä½¿ç”¨æ‚¨è‡ªå·±åˆ›å»ºçš„æƒ…ç»ªè¯†åˆ«å°åº”ç”¨äº†ã€‚

![Gitä¸Šä¼ éƒ¨ç½²åˆ°Web App-10](/images/website.jpg)